MERGE INTO
ZTS_TMS_Transsport_L1
USING
(
SELECT        TOP (100) PERCENT DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESSTATUS, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DOCUMENTSTATE, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DPLB_SCIN_SALESINVENTORYSTATUS, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DPL_SO_STATUS, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DPL_SO_CONFIRM, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESID, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.CUSTACCOUNT, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESNAME, 
                         DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.SALESDISTRICTID, DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.DESCRIPTION, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DLVMODE, LEFT(DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DLVMODE, 7) AS Zone, DPLUSAX63_GOLIVE_2017.dbo.DLVMODE.TXT, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.RECID, SUM(ISNULL(DPLUSAX63_GOLIVE_2017.dbo.SALESLINE.QTYORDERED, 0)) AS QTYORDER, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SHIPPINGDATEREQUESTED, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.ECL_SALESREMARK AS Remark, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DELIVERYPOSTALADDRESS, CONVERT(varchar(10), 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DELIVERYDATE, 120) AS DELIVERYDATE, DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.DATAAREAID, 
                         SUM(ISNULL(DPLUSAX63_GOLIVE_2017.dbo.SALESLINE.REMAINSALESPHYSICAL, 0)) AS deliveryRemainder, SUM(ISNULL(DPLUSAX63_GOLIVE_2017.dbo.SALESLINE.REMAINSALESFINANCIAL, 0)) AS invoiceRemainder, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.CUSTGROUP, MAX(LEFT(DPLUSAX63_GOLIVE_2017.dbo.SALESLINE.ITEMID, 3)) AS L2, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DLVTERM, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.INVENTLOCATIONID, DPLUSAX63_GOLIVE_2017.dbo.CUSTTABLE.DPL_HUB_DLVTERM
FROM            DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP RIGHT OUTER JOIN
                         DPLUSAX63_GOLIVE_2017.dbo.CUSTTABLE ON DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.SALESDISTRICTID = DPLUSAX63_GOLIVE_2017.dbo.CUSTTABLE.SALESDISTRICTID RIGHT OUTER JOIN
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE ON DPLUSAX63_GOLIVE_2017.dbo.CUSTTABLE.ACCOUNTNUM = DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.INVOICEACCOUNT LEFT OUTER JOIN
                         DPLUSAX63_GOLIVE_2017.dbo.DLVMODE ON DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DLVMODE = DPLUSAX63_GOLIVE_2017.dbo.DLVMODE.CODE LEFT OUTER JOIN
                         DPLUSAX63_GOLIVE_2017.dbo.SALESLINE ON DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESID = DPLUSAX63_GOLIVE_2017.dbo.SALESLINE.SALESID
WHERE        (DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESTYPE <> 4) AND (DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.DATAAREAID = N'DPL') AND (CONVERT(varchar(10), 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DELIVERYDATE, 120) BETWEEN '2019-03-26' AND '2019-03-26')
GROUP BY DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESID, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESSTATUS, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DOCUMENTSTATE, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DPLB_SCIN_SALESINVENTORYSTATUS, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DPL_SO_STATUS, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DPL_SO_CONFIRM, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.CUSTACCOUNT, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SALESNAME, DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.SALESDISTRICTID, 
                         DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.DESCRIPTION, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DLVMODE, DPLUSAX63_GOLIVE_2017.dbo.DLVMODE.TXT, 
                         LEFT(DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DLVMODE, 7), DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.RECID, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.SHIPPINGDATEREQUESTED, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.ECL_SALESREMARK, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DELIVERYPOSTALADDRESS, CONVERT(varchar(10), 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DELIVERYDATE, 120), DPLUSAX63_GOLIVE_2017.dbo.SMMBUSRELSALESDISTRICTGROUP.DATAAREAID, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.CUSTGROUP, 
                         DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.DLVTERM, DPLUSAX63_GOLIVE_2017.dbo.SALESTABLE.INVENTLOCATIONID, DPLUSAX63_GOLIVE_2017.dbo.CUSTTABLE.DPL_HUB_DLVTERM
 ) DPLV_SCSO_Transport_L1
ON
ZTS_TMS_Transsport_L1.SALESID = DPLV_SCSO_Transport_L1.SALESID
WHEN MATCHED THEN
UPDATE SET
ZTS_TMS_Transsport_L1.SALESSTATUS = DPLV_SCSO_Transport_L1.SALESSTATUS
,ZTS_TMS_Transsport_L1.DOCUMENTSTATE  =DPLV_SCSO_Transport_L1.DOCUMENTSTATE
,ZTS_TMS_Transsport_L1.DPLB_SCIN_SALESINVENTORYSTATUS    =DPLV_SCSO_Transport_L1.DPLB_SCIN_SALESINVENTORYSTATUS
,ZTS_TMS_Transsport_L1.DPL_SO_STATUS      =DPLV_SCSO_Transport_L1.DPL_SO_STATUS
,ZTS_TMS_Transsport_L1.DPL_SO_CONFIRM  =DPLV_SCSO_Transport_L1.DPL_SO_CONFIRM
,ZTS_TMS_Transsport_L1.CUSTACCOUNT =DPLV_SCSO_Transport_L1.CUSTACCOUNT
,ZTS_TMS_Transsport_L1.SALESNAME            =DPLV_SCSO_Transport_L1.SALESNAME
,ZTS_TMS_Transsport_L1.SALESDISTRICTID=DPLV_SCSO_Transport_L1.SALESDISTRICTID
,ZTS_TMS_Transsport_L1.[DESCRIPTION]      =DPLV_SCSO_Transport_L1.[DESCRIPTION]
,ZTS_TMS_Transsport_L1.DLVMODE  =DPLV_SCSO_Transport_L1.DLVMODE
,ZTS_TMS_Transsport_L1.[Zone] =DPLV_SCSO_Transport_L1.[Zone]
,ZTS_TMS_Transsport_L1.TXT           =DPLV_SCSO_Transport_L1.TXT
,ZTS_TMS_Transsport_L1.RECID           =DPLV_SCSO_Transport_L1.RECID
,ZTS_TMS_Transsport_L1.QTYORDER            =DPLV_SCSO_Transport_L1.QTYORDER
,ZTS_TMS_Transsport_L1.SHIPPINGDATEREQUESTED         =DPLV_SCSO_Transport_L1.SHIPPINGDATEREQUESTED
,ZTS_TMS_Transsport_L1.Remark          =DPLV_SCSO_Transport_L1.DELIVERYPOSTALADDRESS
,ZTS_TMS_Transsport_L1.DELIVERYDATE           =DPLV_SCSO_Transport_L1.DELIVERYDATE
,ZTS_TMS_Transsport_L1.[DATAAREAID]           =DPLV_SCSO_Transport_L1.[DATAAREAID]
,ZTS_TMS_Transsport_L1.[deliveryRemainder]              =DPLV_SCSO_Transport_L1.[deliveryRemainder]
,ZTS_TMS_Transsport_L1.[invoiceRemainder]              =DPLV_SCSO_Transport_L1.[invoiceRemainder]
,ZTS_TMS_Transsport_L1.[CUSTGROUP]              =DPLV_SCSO_Transport_L1.[CUSTGROUP]
,ZTS_TMS_Transsport_L1.L2              =DPLV_SCSO_Transport_L1.L2
,ZTS_TMS_Transsport_L1.[DLVTERM]              =DPLV_SCSO_Transport_L1.[DLVTERM]
,ZTS_TMS_Transsport_L1.INVENTLOCATIONID              =DPLV_SCSO_Transport_L1.INVENTLOCATIONID
,ZTS_TMS_Transsport_L1.[DPL_HUB_DLVTERM]              =DPLV_SCSO_Transport_L1.[DPL_HUB_DLVTERM]
WHEN NOT MATCHED THEN
INSERT
			([SALESSTATUS]
           ,[DOCUMENTSTATE]
           ,[DPLB_SCIN_SALESINVENTORYSTATUS]
           ,[DPL_SO_STATUS]
           ,[DPL_SO_CONFIRM]
           ,[SALESID]
           ,[CUSTACCOUNT]
           ,[SALESNAME]
           ,[SALESDISTRICTID]
           ,[DESCRIPTION]
           ,[DLVMODE]
           ,[Zone]
           ,[TXT]
           ,[RECID]
           ,[QTYORDER]
           ,[SHIPPINGDATEREQUESTED]
           ,[Remark]
           ,[DELIVERYPOSTALADDRESS]
           ,[DELIVERYDATE]
           ,[DATAAREAID]
           ,[deliveryRemainder]
           ,[invoiceRemainder]
           ,[CUSTGROUP]
           ,[L2]
           ,[DLVTERM]
           ,[INVENTLOCATIONID]
           ,[DPL_HUB_DLVTERM])
VALUES
(DPLV_SCSO_Transport_L1.[SALESSTATUS]
,DPLV_SCSO_Transport_L1.[DOCUMENTSTATE]
,DPLV_SCSO_Transport_L1.[DPLB_SCIN_SALESINVENTORYSTATUS]
,DPLV_SCSO_Transport_L1.[DPL_SO_STATUS]
,DPLV_SCSO_Transport_L1.[DPL_SO_CONFIRM]
,DPLV_SCSO_Transport_L1.[SALESID]
,DPLV_SCSO_Transport_L1.[CUSTACCOUNT]
,DPLV_SCSO_Transport_L1.[SALESNAME]
,DPLV_SCSO_Transport_L1.[SALESDISTRICTID]
,DPLV_SCSO_Transport_L1.[DESCRIPTION]
,DPLV_SCSO_Transport_L1.[DLVMODE]
,DPLV_SCSO_Transport_L1.[Zone]
,DPLV_SCSO_Transport_L1.[TXT]
,DPLV_SCSO_Transport_L1.[RECID]
,DPLV_SCSO_Transport_L1.[QTYORDER]
,DPLV_SCSO_Transport_L1.[SHIPPINGDATEREQUESTED]
,DPLV_SCSO_Transport_L1.[Remark]
,DPLV_SCSO_Transport_L1.[DELIVERYPOSTALADDRESS]
,DPLV_SCSO_Transport_L1.[DELIVERYDATE]
,DPLV_SCSO_Transport_L1.[DATAAREAID]
,DPLV_SCSO_Transport_L1.[deliveryRemainder]
,DPLV_SCSO_Transport_L1.[invoiceRemainder]
,DPLV_SCSO_Transport_L1.[CUSTGROUP]
,DPLV_SCSO_Transport_L1.[L2]
,DPLV_SCSO_Transport_L1.[DLVTERM]
,DPLV_SCSO_Transport_L1.[INVENTLOCATIONID]
,DPLV_SCSO_Transport_L1.[DPL_HUB_DLVTERM]);
            